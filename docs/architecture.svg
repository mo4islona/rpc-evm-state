<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 880 720" font-family="Inter, -apple-system, system-ui, sans-serif" font-size="13">
  <defs>
    <marker id="arrow" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6" fill="#64748b"/>
    </marker>
    <marker id="arrow-blue" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6" fill="#3b82f6"/>
    </marker>
    <linearGradient id="grad-pop" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#fef3c7"/>
      <stop offset="100%" stop-color="#fde68a"/>
    </linearGradient>
    <linearGradient id="grad-serve" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#dbeafe"/>
      <stop offset="100%" stop-color="#bfdbfe"/>
    </linearGradient>
    <linearGradient id="grad-client" x1="0" y1="0" x2="0" y2="1">
      <stop offset="0%" stop-color="#d1fae5"/>
      <stop offset="100%" stop-color="#a7f3d0"/>
    </linearGradient>
  </defs>

  <!-- Title -->
  <text x="440" y="30" text-anchor="middle" font-size="20" font-weight="700" fill="#0f172a">EVM State-as-a-Service — Architecture</text>

  <!-- ═══ State Population Layer ═══ -->
  <rect x="40" y="50" width="800" height="260" rx="12" fill="url(#grad-pop)" stroke="#f59e0b" stroke-width="1.5" opacity="0.6"/>
  <text x="60" y="74" font-size="11" font-weight="600" fill="#92400e" letter-spacing="1">STATE POPULATION</text>

  <!-- SQD Network -->
  <rect x="100" y="90" width="180" height="56" rx="8" fill="#fff" stroke="#f59e0b" stroke-width="1.2"/>
  <text x="190" y="114" text-anchor="middle" font-weight="600" fill="#0f172a">SQD Network</text>
  <text x="190" y="132" text-anchor="middle" font-size="11" fill="#64748b">decentralized data lake</text>

  <!-- Snapshot -->
  <rect x="600" y="90" width="180" height="56" rx="8" fill="#fff" stroke="#f59e0b" stroke-width="1.2"/>
  <text x="690" y="114" text-anchor="middle" font-weight="600" fill="#0f172a">Snapshot (.zst)</text>
  <text x="690" y="132" text-anchor="middle" font-size="11" fill="#64748b">pre-built state dump</text>

  <!-- Arrows down -->
  <line x1="190" y1="146" x2="190" y2="170" stroke="#64748b" stroke-width="1.5" marker-end="url(#arrow)"/>
  <line x1="690" y1="146" x2="690" y2="170" stroke="#64748b" stroke-width="1.5" marker-end="url(#arrow)"/>

  <!-- Replayer -->
  <rect x="100" y="174" width="180" height="56" rx="8" fill="#fff" stroke="#f59e0b" stroke-width="1.2"/>
  <text x="190" y="198" text-anchor="middle" font-weight="600" fill="#0f172a">Replayer</text>
  <text x="190" y="216" text-anchor="middle" font-size="11" fill="#64748b">revm tx execution</text>

  <!-- Importer -->
  <rect x="600" y="174" width="180" height="56" rx="8" fill="#fff" stroke="#f59e0b" stroke-width="1.2"/>
  <text x="690" y="198" text-anchor="middle" font-weight="600" fill="#0f172a">Importer</text>
  <text x="690" y="216" text-anchor="middle" font-size="11" fill="#64748b">JSON Lines + zstd</text>

  <!-- Arrows to DB -->
  <line x1="190" y1="230" x2="190" y2="250" stroke="#64748b" stroke-width="1.5"/>
  <line x1="190" y1="250" x2="380" y2="250" stroke="#64748b" stroke-width="1.5"/>
  <line x1="690" y1="230" x2="690" y2="250" stroke="#64748b" stroke-width="1.5"/>
  <line x1="690" y1="250" x2="500" y2="250" stroke="#64748b" stroke-width="1.5"/>
  <line x1="440" y1="250" x2="440" y2="262" stroke="#64748b" stroke-width="1.5" marker-end="url(#arrow)"/>

  <!-- State Database -->
  <rect x="200" y="266" width="480" height="32" rx="6" fill="#fff" stroke="#f59e0b" stroke-width="1.5"/>
  <text x="440" y="287" text-anchor="middle" font-weight="600" fill="#0f172a">State Database (RocksDB)</text>
  <rect x="220" y="298" width="100" height="0" rx="0" fill="none"/>

  <!-- DB table labels (inside population box) -->
  <g transform="translate(440, 287)">
    <!-- sub-row -->
  </g>

  <!-- ═══ State Serving Layer ═══ -->
  <rect x="40" y="330" width="800" height="130" rx="12" fill="url(#grad-serve)" stroke="#3b82f6" stroke-width="1.5" opacity="0.6"/>
  <text x="60" y="354" font-size="11" font-weight="600" fill="#1e40af" letter-spacing="1">STATE SERVING</text>

  <!-- Arrow from DB to API -->
  <line x1="440" y1="298" x2="440" y2="370" stroke="#64748b" stroke-width="1.5" marker-end="url(#arrow)"/>

  <!-- API Server -->
  <rect x="140" y="374" width="600" height="70" rx="8" fill="#fff" stroke="#3b82f6" stroke-width="1.2"/>
  <text x="440" y="398" text-anchor="middle" font-weight="600" fill="#0f172a">API Server (axum)</text>
  <text x="440" y="418" text-anchor="middle" font-size="11" fill="#64748b">
    <tspan>/v1/head</tspan>
    <tspan dx="12">/v1/account</tspan>
    <tspan dx="12">/v1/storage</tspan>
    <tspan dx="12">/v1/code</tspan>
    <tspan dx="12">/v1/batch</tspan>
    <tspan dx="12">/v1/prefetch</tspan>
  </text>
  <text x="440" y="434" text-anchor="middle" font-size="11" fill="#64748b">/v1/stream (WebSocket)</text>

  <!-- ═══ Client Layer ═══ -->
  <rect x="40" y="480" width="800" height="230" rx="12" fill="url(#grad-client)" stroke="#10b981" stroke-width="1.5" opacity="0.6"/>
  <text x="60" y="504" font-size="11" font-weight="600" fill="#065f46" letter-spacing="1">CLIENT LAYER</text>

  <!-- Arrow from API to Client -->
  <line x1="440" y1="444" x2="440" y2="516" stroke="#3b82f6" stroke-width="1.5" marker-end="url(#arrow-blue)"/>
  <text x="448" y="484" font-size="10" fill="#3b82f6">HTTP / WS</text>

  <!-- Prefetch box -->
  <rect x="120" y="520" width="640" height="44" rx="8" fill="#fff" stroke="#10b981" stroke-width="1.2"/>
  <text x="440" y="540" text-anchor="middle" font-weight="600" fill="#0f172a">Prefetch (1 round-trip)</text>
  <text x="440" y="556" text-anchor="middle" font-size="11" fill="#64748b">server executes call, returns result + state slice + access list</text>

  <!-- Branch arrows -->
  <line x1="320" y1="564" x2="320" y2="598" stroke="#64748b" stroke-width="1.5" marker-end="url(#arrow)"/>
  <line x1="560" y1="564" x2="560" y2="598" stroke="#64748b" stroke-width="1.5" marker-end="url(#arrow)"/>

  <!-- TrustServer -->
  <rect x="220" y="602" width="200" height="48" rx="8" fill="#fff" stroke="#10b981" stroke-width="1.2"/>
  <text x="320" y="624" text-anchor="middle" font-weight="600" fill="#0f172a">TrustServer</text>
  <text x="320" y="640" text-anchor="middle" font-size="11" fill="#64748b">use server result directly</text>

  <!-- Verify -->
  <rect x="460" y="602" width="200" height="48" rx="8" fill="#fff" stroke="#10b981" stroke-width="1.2"/>
  <text x="560" y="624" text-anchor="middle" font-weight="600" fill="#0f172a">Verify</text>
  <text x="560" y="640" text-anchor="middle" font-size="11" fill="#64748b">re-execute locally with revm</text>

  <!-- Client SDKs -->
  <rect x="140" y="668" width="170" height="30" rx="6" fill="#ecfdf5" stroke="#10b981" stroke-width="1"/>
  <text x="225" y="688" text-anchor="middle" font-size="12" fill="#065f46" font-weight="500">Rust Client</text>

  <rect x="355" y="668" width="170" height="30" rx="6" fill="#ecfdf5" stroke="#10b981" stroke-width="1"/>
  <text x="440" y="688" text-anchor="middle" font-size="12" fill="#065f46" font-weight="500">WASM Module</text>

  <rect x="570" y="668" width="170" height="30" rx="6" fill="#ecfdf5" stroke="#10b981" stroke-width="1"/>
  <text x="655" y="688" text-anchor="middle" font-size="12" fill="#065f46" font-weight="500">TypeScript SDK</text>
</svg>
