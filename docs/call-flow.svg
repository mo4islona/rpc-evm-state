<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 820 520" font-family="Inter, -apple-system, system-ui, sans-serif" font-size="13">
  <defs>
    <marker id="arr" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6" fill="#3b82f6"/>
    </marker>
    <marker id="arr-ret" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6" fill="#10b981"/>
    </marker>
    <marker id="arr-gray" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6" fill="#94a3b8"/>
    </marker>
  </defs>

  <!-- Title -->
  <text x="410" y="28" text-anchor="middle" font-size="18" font-weight="700" fill="#0f172a">Client Call Flow â€” Prefetch + Verify</text>

  <!-- Column headers -->
  <rect x="60" y="50" width="150" height="36" rx="8" fill="#d1fae5" stroke="#10b981" stroke-width="1.2"/>
  <text x="135" y="73" text-anchor="middle" font-weight="600" fill="#065f46">Client</text>

  <rect x="335" y="50" width="150" height="36" rx="8" fill="#dbeafe" stroke="#3b82f6" stroke-width="1.2"/>
  <text x="410" y="73" text-anchor="middle" font-weight="600" fill="#1e40af">API Server</text>

  <rect x="610" y="50" width="150" height="36" rx="8" fill="#fef3c7" stroke="#f59e0b" stroke-width="1.2"/>
  <text x="685" y="73" text-anchor="middle" font-weight="600" fill="#92400e">State DB</text>

  <!-- Lifelines -->
  <line x1="135" y1="86" x2="135" y2="500" stroke="#cbd5e1" stroke-width="1" stroke-dasharray="4,4"/>
  <line x1="410" y1="86" x2="410" y2="500" stroke="#cbd5e1" stroke-width="1" stroke-dasharray="4,4"/>
  <line x1="685" y1="86" x2="685" y2="500" stroke="#cbd5e1" stroke-width="1" stroke-dasharray="4,4"/>

  <!-- Step 1: POST /v1/prefetch -->
  <line x1="140" y1="120" x2="400" y2="120" stroke="#3b82f6" stroke-width="1.5" marker-end="url(#arr)"/>
  <rect x="175" y="102" width="200" height="18" rx="3" fill="#eff6ff"/>
  <text x="275" y="115" text-anchor="middle" font-size="12" fill="#1e40af" font-weight="500">POST /v1/prefetch</text>
  <text x="275" y="100" text-anchor="middle" font-size="10" fill="#64748b">1</text>

  <!-- Step 1 label -->
  <rect x="10" y="128" width="120" height="28" rx="4" fill="#f1f5f9"/>
  <text x="70" y="147" text-anchor="middle" font-size="10" fill="#475569">{to, calldata}</text>

  <!-- Step 2: Execute with revm -->
  <rect x="345" y="140" width="130" height="32" rx="6" fill="#eff6ff" stroke="#3b82f6" stroke-width="1" stroke-dasharray="3,2"/>
  <text x="410" y="158" text-anchor="middle" font-size="11" fill="#1e40af">Execute w/ revm</text>
  <text x="410" y="170" text-anchor="middle" font-size="10" fill="#64748b">+ AccessListInspector</text>
  <text x="340" y="150" text-anchor="end" font-size="10" fill="#64748b">2</text>

  <!-- Step 3: Read state -->
  <line x1="415" y1="180" x2="675" y2="180" stroke="#3b82f6" stroke-width="1.5" marker-end="url(#arr)"/>
  <text x="545" y="175" text-anchor="middle" font-size="11" fill="#1e40af">SLOAD / BALANCE / CODE</text>
  <text x="545" y="195" text-anchor="middle" font-size="10" fill="#64748b">3</text>

  <!-- Step 4: Return values -->
  <line x1="675" y1="210" x2="415" y2="210" stroke="#10b981" stroke-width="1.5" marker-end="url(#arr-ret)"/>
  <text x="545" y="206" text-anchor="middle" font-size="11" fill="#059669">state values</text>
  <text x="545" y="226" text-anchor="middle" font-size="10" fill="#64748b">4</text>

  <!-- Step 5: Build access list -->
  <rect x="345" y="235" width="130" height="28" rx="6" fill="#eff6ff" stroke="#3b82f6" stroke-width="1" stroke-dasharray="3,2"/>
  <text x="410" y="254" text-anchor="middle" font-size="11" fill="#1e40af">Build state slice</text>
  <text x="340" y="250" text-anchor="end" font-size="10" fill="#64748b">5</text>

  <!-- Step 6: Return response -->
  <line x1="400" y1="278" x2="140" y2="278" stroke="#10b981" stroke-width="1.5" marker-end="url(#arr-ret)"/>
  <text x="270" y="273" text-anchor="middle" font-size="11" fill="#059669">result + access_list + state_slice</text>
  <text x="270" y="293" text-anchor="middle" font-size="10" fill="#64748b">6</text>

  <!-- Divider: TrustServer vs Verify -->
  <line x1="30" y1="320" x2="790" y2="320" stroke="#e2e8f0" stroke-width="1"/>

  <!-- TrustServer path -->
  <rect x="30" y="330" width="360" height="160" rx="10" fill="#f0fdf4" stroke="#86efac" stroke-width="1" opacity="0.7"/>
  <text x="50" y="352" font-size="12" font-weight="600" fill="#065f46">TrustServer mode</text>

  <rect x="60" y="366" width="300" height="44" rx="6" fill="#fff" stroke="#10b981" stroke-width="1"/>
  <text x="210" y="386" text-anchor="middle" font-size="12" fill="#0f172a" font-weight="500">Return server result directly</text>
  <text x="210" y="402" text-anchor="middle" font-size="11" fill="#64748b">1 round-trip, ~1ms</text>

  <rect x="60" y="424" width="300" height="52" rx="6" fill="#f8fafc" stroke="#cbd5e1" stroke-width="1"/>
  <text x="210" y="444" text-anchor="middle" font-size="11" fill="#475569">Best for: trusted servers, indexing,</text>
  <text x="210" y="460" text-anchor="middle" font-size="11" fill="#475569">high-throughput batch reads</text>

  <!-- Verify path -->
  <rect x="430" y="330" width="360" height="160" rx="10" fill="#eff6ff" stroke="#93c5fd" stroke-width="1" opacity="0.7"/>
  <text x="450" y="352" font-size="12" font-weight="600" fill="#1e40af">Verify mode</text>

  <rect x="460" y="366" width="300" height="44" rx="6" fill="#fff" stroke="#3b82f6" stroke-width="1"/>
  <text x="610" y="386" text-anchor="middle" font-size="12" fill="#0f172a" font-weight="500">Re-execute locally with revm</text>
  <text x="610" y="402" text-anchor="middle" font-size="11" fill="#64748b">1 round-trip + local EVM, ~2ms</text>

  <rect x="460" y="424" width="300" height="52" rx="6" fill="#f8fafc" stroke="#cbd5e1" stroke-width="1"/>
  <text x="610" y="444" text-anchor="middle" font-size="11" fill="#475569">Best for: trustless operation,</text>
  <text x="610" y="460" text-anchor="middle" font-size="11" fill="#475569">correctness verification, audits</text>
</svg>
