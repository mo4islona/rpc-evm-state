<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 720 300" font-family="Inter, -apple-system, system-ui, sans-serif" font-size="13">
  <defs>
    <marker id="arr" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6 Z" fill="#64748b"/>
    </marker>
    <marker id="arr-blue" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6 Z" fill="#3b82f6"/>
    </marker>
    <marker id="arr-green" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6 Z" fill="#16a34a"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="720" height="300" rx="8" fill="#fafbfc"/>

  <!-- Title -->
  <text x="360" y="28" text-anchor="middle" font-size="16" font-weight="700" fill="#1e293b">TrustServer Mode — call() Flow</text>

  <!-- StateClient box -->
  <rect x="20" y="55" width="160" height="80" rx="6" fill="#eff6ff" stroke="#bfdbfe" stroke-width="1.5"/>
  <text x="100" y="78" text-anchor="middle" font-size="12" font-weight="600" fill="#1e40af">StateClient</text>
  <line x1="35" y1="85" x2="165" y2="85" stroke="#bfdbfe" stroke-width="1"/>
  <text x="40" y="102" font-size="10" fill="#475569">mode: TrustServer</text>
  <text x="40" y="118" font-size="10" fill="#475569">call(to, calldata, ...)</text>

  <!-- Arrow: StateClient → prefetch -->
  <line x1="180" y1="95" x2="218" y2="95" stroke="#64748b" stroke-width="1.5" marker-end="url(#arr)"/>
  <text x="199" y="88" text-anchor="middle" font-size="9" fill="#64748b">1</text>

  <!-- Prefetch POST box -->
  <rect x="225" y="55" width="200" height="80" rx="6" fill="#fff7ed" stroke="#fdba74" stroke-width="1.5"/>
  <text x="325" y="78" text-anchor="middle" font-size="12" font-weight="600" fill="#ea580c">POST /v1/prefetch</text>
  <line x1="240" y1="85" x2="410" y2="85" stroke="#fdba74" stroke-width="1"/>
  <text x="245" y="102" font-size="10" fill="#78350f">Server executes call with revm</text>
  <text x="245" y="118" font-size="10" fill="#78350f">Returns result + state_slice</text>

  <!-- Arrow: prefetch → cache populate -->
  <line x1="325" y1="135" x2="325" y2="163" stroke="#3b82f6" stroke-width="1.5" marker-end="url(#arr-blue)"/>
  <text x="338" y="153" font-size="9" fill="#3b82f6">2</text>

  <!-- Cache populate box -->
  <rect x="225" y="168" width="200" height="50" rx="6" fill="#eef2ff" stroke="#a5b4fc" stroke-width="1.5"/>
  <text x="325" y="190" text-anchor="middle" font-size="11" font-weight="600" fill="#3730a3">Cache populated</text>
  <text x="325" y="207" text-anchor="middle" font-size="10" fill="#6366f1">accounts + storage + code</text>

  <!-- Arrow: StateClient → return result directly -->
  <line x1="425" y1="95" x2="468" y2="95" stroke="#16a34a" stroke-width="1.5" marker-end="url(#arr-green)"/>
  <text x="446" y="88" text-anchor="middle" font-size="9" fill="#16a34a">3</text>

  <!-- CallResult box -->
  <rect x="475" y="55" width="220" height="105" rx="6" fill="#f0fdf4" stroke="#86efac" stroke-width="1.5"/>
  <text x="585" y="78" text-anchor="middle" font-size="12" font-weight="600" fill="#166534">CallResult</text>
  <line x1="490" y1="85" x2="680" y2="85" stroke="#86efac" stroke-width="1"/>
  <text x="495" y="102" font-size="11" fill="#475569">output: server result bytes</text>
  <text x="495" y="120" font-size="11" fill="#475569">success: true/false</text>
  <text x="495" y="138" font-size="11" fill="#64748b">verified: None</text>
  <text x="495" y="152" font-size="9" fill="#94a3b8">(no local verification)</text>

  <!-- Key insight -->
  <rect x="475" y="190" width="220" height="60" rx="5" fill="#fff7ed" stroke="#fed7aa" stroke-width="1"/>
  <text x="485" y="210" font-size="10" font-weight="600" fill="#9a3412">Trust mode:</text>
  <text x="485" y="226" font-size="10" fill="#78350f">&#8226; Single HTTP round-trip</text>
  <text x="485" y="241" font-size="10" fill="#78350f">&#8226; Server result used directly</text>

  <!-- Flow label -->
  <text x="360" y="285" text-anchor="middle" font-size="10" fill="#94a3b8">Cache is populated for future DatabaseRef reads, but result comes straight from the server.</text>
</svg>
