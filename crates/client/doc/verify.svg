<svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 820 380" font-family="Inter, -apple-system, system-ui, sans-serif" font-size="13">
  <defs>
    <marker id="arr" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6 Z" fill="#64748b"/>
    </marker>
    <marker id="arr-blue" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6 Z" fill="#3b82f6"/>
    </marker>
    <marker id="arr-green" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6 Z" fill="#16a34a"/>
    </marker>
    <marker id="arr-orange" markerWidth="8" markerHeight="6" refX="8" refY="3" orient="auto">
      <path d="M0,0 L8,3 L0,6 Z" fill="#ea580c"/>
    </marker>
  </defs>

  <!-- Background -->
  <rect width="820" height="380" rx="8" fill="#fafbfc"/>

  <!-- Title -->
  <text x="410" y="28" text-anchor="middle" font-size="16" font-weight="700" fill="#1e293b">Verify Mode — call() Flow</text>

  <!-- StateClient box -->
  <rect x="20" y="55" width="150" height="80" rx="6" fill="#eff6ff" stroke="#bfdbfe" stroke-width="1.5"/>
  <text x="95" y="78" text-anchor="middle" font-size="12" font-weight="600" fill="#1e40af">StateClient</text>
  <line x1="35" y1="85" x2="155" y2="85" stroke="#bfdbfe" stroke-width="1"/>
  <text x="40" y="102" font-size="10" fill="#475569">mode: Verify</text>
  <text x="40" y="118" font-size="10" fill="#475569">call(to, calldata, ...)</text>

  <!-- Arrow: StateClient → prefetch -->
  <line x1="170" y1="95" x2="208" y2="95" stroke="#64748b" stroke-width="1.5" marker-end="url(#arr)"/>
  <text x="189" y="88" text-anchor="middle" font-size="9" fill="#64748b">1</text>

  <!-- Prefetch POST box -->
  <rect x="215" y="55" width="190" height="80" rx="6" fill="#fff7ed" stroke="#fdba74" stroke-width="1.5"/>
  <text x="310" y="78" text-anchor="middle" font-size="12" font-weight="600" fill="#ea580c">POST /v1/prefetch</text>
  <line x1="230" y1="85" x2="390" y2="85" stroke="#fdba74" stroke-width="1"/>
  <text x="235" y="102" font-size="10" fill="#78350f">Server executes call</text>
  <text x="235" y="118" font-size="10" fill="#78350f">Returns result + state_slice</text>

  <!-- Arrow: prefetch → cache -->
  <line x1="310" y1="135" x2="310" y2="163" stroke="#3b82f6" stroke-width="1.5" marker-end="url(#arr-blue)"/>
  <text x="323" y="153" font-size="9" fill="#3b82f6">2</text>

  <!-- Cache box -->
  <rect x="215" y="168" width="190" height="50" rx="6" fill="#eef2ff" stroke="#a5b4fc" stroke-width="1.5"/>
  <text x="310" y="190" text-anchor="middle" font-size="11" font-weight="600" fill="#3730a3">RemoteDB cache warm</text>
  <text x="310" y="207" text-anchor="middle" font-size="10" fill="#6366f1">accounts + storage + code</text>

  <!-- Arrow: cache → local EVM -->
  <line x1="405" y1="193" x2="438" y2="193" stroke="#16a34a" stroke-width="1.5" marker-end="url(#arr-green)"/>
  <text x="421" y="186" text-anchor="middle" font-size="9" fill="#16a34a">3</text>

  <!-- Local EVM re-execution box -->
  <rect x="445" y="55" width="190" height="165" rx="6" fill="#f0fdf4" stroke="#86efac" stroke-width="1.5"/>
  <text x="540" y="78" text-anchor="middle" font-size="12" font-weight="600" fill="#166534">Local revm execution</text>
  <line x1="460" y1="85" x2="620" y2="85" stroke="#86efac" stroke-width="1"/>
  <text x="465" y="102" font-size="10" fill="#475569">WrapDatabaseRef(RemoteDB)</text>
  <text x="465" y="118" font-size="10" fill="#475569">All reads hit warm cache</text>
  <text x="465" y="134" font-size="10" fill="#475569">&#8594; no HTTP round-trips</text>
  <line x1="460" y1="145" x2="620" y2="145" stroke="#86efac" stroke-width="0.5"/>
  <text x="465" y="162" font-size="10" font-weight="600" fill="#166534">Compare:</text>
  <text x="465" y="178" font-size="10" fill="#475569">local.output == server.result?</text>
  <text x="465" y="194" font-size="10" fill="#475569">local.success == server.success?</text>
  <text x="465" y="210" font-size="10" fill="#16a34a">match &#8594; verified: Some(true)</text>

  <!-- Arrow: local EVM → result -->
  <line x1="635" y1="140" x2="668" y2="140" stroke="#64748b" stroke-width="1.5" marker-end="url(#arr)"/>
  <text x="651" y="133" text-anchor="middle" font-size="9" fill="#64748b">4</text>

  <!-- CallResult box -->
  <rect x="675" y="55" width="130" height="115" rx="6" fill="#faf5ff" stroke="#d8b4fe" stroke-width="1.5"/>
  <text x="740" y="78" text-anchor="middle" font-size="12" font-weight="600" fill="#7c3aed">CallResult</text>
  <line x1="685" y1="85" x2="795" y2="85" stroke="#d8b4fe" stroke-width="1"/>
  <text x="685" y="104" font-size="10" fill="#475569">output: local</text>
  <text x="685" y="120" font-size="10" fill="#475569">success: local</text>
  <text x="685" y="136" font-size="10" font-weight="600" fill="#16a34a">verified:</text>
  <text x="685" y="150" font-size="10" fill="#16a34a">Some(true/false)</text>

  <!-- Key insight -->
  <rect x="20" y="250" width="390" height="75" rx="5" fill="#fff7ed" stroke="#fed7aa" stroke-width="1"/>
  <text x="30" y="270" font-size="10" font-weight="600" fill="#9a3412">Verify mode guarantees:</text>
  <text x="30" y="288" font-size="10" fill="#78350f">&#8226; Result comes from local execution (trustless)</text>
  <text x="30" y="303" font-size="10" fill="#78350f">&#8226; Cache pre-warmed by prefetch &#8594; zero extra HTTP calls during re-execution</text>
  <text x="30" y="318" font-size="10" fill="#78350f">&#8226; Detects server bugs or malicious results via comparison</text>

  <!-- Data flow note -->
  <rect x="445" y="250" width="360" height="75" rx="5" fill="#f0fdf4" stroke="#86efac" stroke-width="1"/>
  <text x="455" y="270" font-size="10" font-weight="600" fill="#166534">Performance:</text>
  <text x="455" y="288" font-size="10" fill="#475569">&#8226; 1 HTTP round-trip (same as TrustServer)</text>
  <text x="455" y="303" font-size="10" fill="#475569">&#8226; + local EVM execution (fast, no I/O)</text>
  <text x="455" y="318" font-size="10" fill="#475569">&#8226; Cost: ~milliseconds of CPU for verification</text>
</svg>
